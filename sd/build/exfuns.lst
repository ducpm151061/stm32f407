ARM GAS  C:\Users\ADMIN\AppData\Local\Temp\ccScV10L.s 			page 1


   1              		.cpu cortex-m4
   2              		.eabi_attribute 27, 1
   3              		.eabi_attribute 28, 1
   4              		.eabi_attribute 20, 1
   5              		.eabi_attribute 21, 1
   6              		.eabi_attribute 23, 3
   7              		.eabi_attribute 24, 1
   8              		.eabi_attribute 25, 1
   9              		.eabi_attribute 26, 1
  10              		.eabi_attribute 30, 1
  11              		.eabi_attribute 34, 1
  12              		.eabi_attribute 18, 4
  13              		.file	"exfuns.c"
  14              		.text
  15              	.Ltext0:
  16              		.cfi_sections	.debug_frame
  17              		.section	.text.exfuns_init,"ax",%progbits
  18              		.align	1
  19              		.global	exfuns_init
  20              		.arch armv7e-m
  21              		.syntax unified
  22              		.thumb
  23              		.thumb_func
  24              		.fpu fpv4-sp-d16
  26              	exfuns_init:
  27              	.LFB133:
  28              		.file 1 "Core/Src/exfuns.c"
   1:Core/Src/exfuns.c **** #include "string.h"
   2:Core/Src/exfuns.c **** #include "exfuns.h"
   3:Core/Src/exfuns.c **** #include "fattester.h"	
   4:Core/Src/exfuns.c **** #include "malloc.h"
   5:Core/Src/exfuns.c **** #include "usart.h"
   6:Core/Src/exfuns.c **** 
   7:Core/Src/exfuns.c **** 
   8:Core/Src/exfuns.c ****  //文件类型列表
   9:Core/Src/exfuns.c **** const u8 *FILE_TYPE_TBL[6][13]=
  10:Core/Src/exfuns.c **** {
  11:Core/Src/exfuns.c **** {"BIN"},			//BIN文件
  12:Core/Src/exfuns.c **** {"LRC"},			//LRC文件
  13:Core/Src/exfuns.c **** {"NES"},			//NES文件
  14:Core/Src/exfuns.c **** {"TXT","C","H"},	//文本文件
  15:Core/Src/exfuns.c **** {"MP1","MP2","MP3","MP4","M4A","3GP","3G2","OGG","ACC","WMA","WAV","MID","FLAC"},//音乐文件
  16:Core/Src/exfuns.c **** {"BMP","JPG","JPEG","GIF"},//图片文件
  17:Core/Src/exfuns.c **** };
  18:Core/Src/exfuns.c **** ///////////////////////////////公共文件区,使用malloc的时候/////////////////////////////////////////
  19:Core/Src/exfuns.c **** FATFS *fs[2];  		//逻辑磁盘工作区.	 
  20:Core/Src/exfuns.c **** FIL *file;	  		//文件1
  21:Core/Src/exfuns.c **** FIL *ftemp;	  		//文件2.
  22:Core/Src/exfuns.c **** UINT br,bw;			//读写变量
  23:Core/Src/exfuns.c **** FILINFO fileinfo;	//文件信息
  24:Core/Src/exfuns.c **** DIR dir;  			//目录
  25:Core/Src/exfuns.c **** 
  26:Core/Src/exfuns.c **** u8 *fatbuf;			//SD卡数据缓存区
  27:Core/Src/exfuns.c **** ///////////////////////////////////////////////////////////////////////////////////////
  28:Core/Src/exfuns.c **** //为exfuns申请内存
  29:Core/Src/exfuns.c **** //返回值:0,成功
  30:Core/Src/exfuns.c **** //1,失败
ARM GAS  C:\Users\ADMIN\AppData\Local\Temp\ccScV10L.s 			page 2


  31:Core/Src/exfuns.c **** u8 exfuns_init(void)
  32:Core/Src/exfuns.c **** {
  29              		.loc 1 32 1 view -0
  30              		.cfi_startproc
  31              		@ args = 0, pretend = 0, frame = 0
  32              		@ frame_needed = 0, uses_anonymous_args = 0
  33 0000 10B5     		push	{r4, lr}
  34              	.LCFI0:
  35              		.cfi_def_cfa_offset 8
  36              		.cfi_offset 4, -8
  37              		.cfi_offset 14, -4
  33:Core/Src/exfuns.c **** 	fs[0]=(FATFS*)mymalloc(SRAMIN,sizeof(FATFS));	//为磁盘0工作区申请内存	
  38              		.loc 1 33 2 view .LVU1
  39              		.loc 1 33 16 is_stmt 0 view .LVU2
  40 0002 4FF40C71 		mov	r1, #560
  41 0006 0020     		movs	r0, #0
  42 0008 FFF7FEFF 		bl	mymalloc
  43              	.LVL0:
  44              		.loc 1 33 7 view .LVU3
  45 000c 194C     		ldr	r4, .L10
  46 000e 2060     		str	r0, [r4]
  34:Core/Src/exfuns.c **** 	fs[1]=(FATFS*)mymalloc(SRAMIN,sizeof(FATFS));	//为磁盘1工作区申请内存
  47              		.loc 1 34 2 is_stmt 1 view .LVU4
  48              		.loc 1 34 16 is_stmt 0 view .LVU5
  49 0010 4FF40C71 		mov	r1, #560
  50 0014 0020     		movs	r0, #0
  51 0016 FFF7FEFF 		bl	mymalloc
  52              	.LVL1:
  53              		.loc 1 34 7 view .LVU6
  54 001a 6060     		str	r0, [r4, #4]
  35:Core/Src/exfuns.c **** 	file=(FIL*)mymalloc(SRAMIN,sizeof(FIL));		//为file申请内存
  55              		.loc 1 35 2 is_stmt 1 view .LVU7
  56              		.loc 1 35 13 is_stmt 0 view .LVU8
  57 001c 4FF40A71 		mov	r1, #552
  58 0020 0020     		movs	r0, #0
  59 0022 FFF7FEFF 		bl	mymalloc
  60              	.LVL2:
  61              		.loc 1 35 6 view .LVU9
  62 0026 144B     		ldr	r3, .L10+4
  63 0028 1860     		str	r0, [r3]
  36:Core/Src/exfuns.c **** 	ftemp=(FIL*)mymalloc(SRAMIN,sizeof(FIL));		//为ftemp申请内存
  64              		.loc 1 36 2 is_stmt 1 view .LVU10
  65              		.loc 1 36 14 is_stmt 0 view .LVU11
  66 002a 4FF40A71 		mov	r1, #552
  67 002e 0020     		movs	r0, #0
  68 0030 FFF7FEFF 		bl	mymalloc
  69              	.LVL3:
  70              		.loc 1 36 7 view .LVU12
  71 0034 114B     		ldr	r3, .L10+8
  72 0036 1860     		str	r0, [r3]
  37:Core/Src/exfuns.c **** 	fatbuf=(u8*)mymalloc(SRAMIN,512);				//为fatbuf申请内存
  73              		.loc 1 37 2 is_stmt 1 view .LVU13
  74              		.loc 1 37 14 is_stmt 0 view .LVU14
  75 0038 4FF40071 		mov	r1, #512
  76 003c 0020     		movs	r0, #0
  77 003e FFF7FEFF 		bl	mymalloc
  78              	.LVL4:
ARM GAS  C:\Users\ADMIN\AppData\Local\Temp\ccScV10L.s 			page 3


  79              		.loc 1 37 8 view .LVU15
  80 0042 0F4B     		ldr	r3, .L10+12
  81 0044 1860     		str	r0, [r3]
  38:Core/Src/exfuns.c **** 	if(fs[0]&&fs[1]&&file&&ftemp&&fatbuf)return 0;  //申请有一个失败,即失败.
  82              		.loc 1 38 2 is_stmt 1 view .LVU16
  83              		.loc 1 38 7 is_stmt 0 view .LVU17
  84 0046 2368     		ldr	r3, [r4]
  85              		.loc 1 38 4 view .LVU18
  86 0048 63B1     		cbz	r3, .L3
  87              		.loc 1 38 14 discriminator 1 view .LVU19
  88 004a 6368     		ldr	r3, [r4, #4]
  89              		.loc 1 38 10 discriminator 1 view .LVU20
  90 004c 63B1     		cbz	r3, .L4
  91              		.loc 1 38 17 discriminator 2 view .LVU21
  92 004e 0A4B     		ldr	r3, .L10+4
  93 0050 1B68     		ldr	r3, [r3]
  94 0052 5BB1     		cbz	r3, .L5
  95              		.loc 1 38 23 discriminator 3 view .LVU22
  96 0054 094B     		ldr	r3, .L10+8
  97 0056 1B68     		ldr	r3, [r3]
  98 0058 53B1     		cbz	r3, .L6
  99              		.loc 1 38 30 discriminator 4 view .LVU23
 100 005a 08B1     		cbz	r0, .L9
 101              		.loc 1 38 46 view .LVU24
 102 005c 0020     		movs	r0, #0
 103              	.L2:
  39:Core/Src/exfuns.c **** 	else return 1;	
  40:Core/Src/exfuns.c **** }
 104              		.loc 1 40 1 view .LVU25
 105 005e 10BD     		pop	{r4, pc}
 106              	.L9:
  39:Core/Src/exfuns.c **** 	else return 1;	
 107              		.loc 1 39 14 view .LVU26
 108 0060 0120     		movs	r0, #1
 109 0062 FCE7     		b	.L2
 110              	.L3:
 111 0064 0120     		movs	r0, #1
 112 0066 FAE7     		b	.L2
 113              	.L4:
 114 0068 0120     		movs	r0, #1
 115 006a F8E7     		b	.L2
 116              	.L5:
 117 006c 0120     		movs	r0, #1
 118 006e F6E7     		b	.L2
 119              	.L6:
 120 0070 0120     		movs	r0, #1
 121 0072 F4E7     		b	.L2
 122              	.L11:
 123              		.align	2
 124              	.L10:
 125 0074 00000000 		.word	.LANCHOR0
 126 0078 00000000 		.word	.LANCHOR1
 127 007c 00000000 		.word	.LANCHOR2
 128 0080 00000000 		.word	.LANCHOR3
 129              		.cfi_endproc
 130              	.LFE133:
 132              		.section	.text.char_upper,"ax",%progbits
ARM GAS  C:\Users\ADMIN\AppData\Local\Temp\ccScV10L.s 			page 4


 133              		.align	1
 134              		.global	char_upper
 135              		.syntax unified
 136              		.thumb
 137              		.thumb_func
 138              		.fpu fpv4-sp-d16
 140              	char_upper:
 141              	.LVL5:
 142              	.LFB134:
  41:Core/Src/exfuns.c **** 
  42:Core/Src/exfuns.c **** //将小写字母转为大写字母,如果是数字,则保持不变.
  43:Core/Src/exfuns.c **** u8 char_upper(u8 c)
  44:Core/Src/exfuns.c **** {
 143              		.loc 1 44 1 is_stmt 1 view -0
 144              		.cfi_startproc
 145              		@ args = 0, pretend = 0, frame = 0
 146              		@ frame_needed = 0, uses_anonymous_args = 0
 147              		@ link register save eliminated.
  45:Core/Src/exfuns.c **** 	if(c<'A')return c;//数字,保持不变.
 148              		.loc 1 45 2 view .LVU28
 149              		.loc 1 45 4 is_stmt 0 view .LVU29
 150 0000 4028     		cmp	r0, #64
 151 0002 03D9     		bls	.L13
  46:Core/Src/exfuns.c **** 	if(c>='a')return c-0x20;//变为大写.
 152              		.loc 1 46 2 is_stmt 1 view .LVU30
 153              		.loc 1 46 4 is_stmt 0 view .LVU31
 154 0004 6028     		cmp	r0, #96
 155 0006 01D9     		bls	.L13
 156              		.loc 1 46 12 is_stmt 1 discriminator 1 view .LVU32
 157              		.loc 1 46 20 is_stmt 0 discriminator 1 view .LVU33
 158 0008 2038     		subs	r0, r0, #32
 159              	.LVL6:
 160              		.loc 1 46 20 discriminator 1 view .LVU34
 161 000a C0B2     		uxtb	r0, r0
 162              	.L13:
  47:Core/Src/exfuns.c **** 	else return c;//大写,保持不变
  48:Core/Src/exfuns.c **** }	      
 163              		.loc 1 48 1 view .LVU35
 164 000c 7047     		bx	lr
 165              		.cfi_endproc
 166              	.LFE134:
 168              		.section	.text.f_typetell,"ax",%progbits
 169              		.align	1
 170              		.global	f_typetell
 171              		.syntax unified
 172              		.thumb
 173              		.thumb_func
 174              		.fpu fpv4-sp-d16
 176              	f_typetell:
 177              	.LVL7:
 178              	.LFB135:
  49:Core/Src/exfuns.c **** //报告文件的类型
  50:Core/Src/exfuns.c **** //fname:文件名
  51:Core/Src/exfuns.c **** //返回值:0XFF,表示无法识别的文件类型编号.
  52:Core/Src/exfuns.c **** //		 其他,高四位表示所属大类,低四位表示所属小类.
  53:Core/Src/exfuns.c **** u8 f_typetell(u8 *fname)
  54:Core/Src/exfuns.c **** {
ARM GAS  C:\Users\ADMIN\AppData\Local\Temp\ccScV10L.s 			page 5


 179              		.loc 1 54 1 is_stmt 1 view -0
 180              		.cfi_startproc
 181              		@ args = 0, pretend = 0, frame = 8
 182              		@ frame_needed = 0, uses_anonymous_args = 0
 183              		.loc 1 54 1 is_stmt 0 view .LVU37
 184 0000 0146     		mov	r1, r0
  55:Core/Src/exfuns.c **** 	u8 tbuf[5];
 185              		.loc 1 55 2 is_stmt 1 view .LVU38
  56:Core/Src/exfuns.c **** 	u8 *attr='\0';//后缀名
 186              		.loc 1 56 2 view .LVU39
 187              	.LVL8:
  57:Core/Src/exfuns.c **** 	u8 i=0,j;
 188              		.loc 1 57 2 view .LVU40
  58:Core/Src/exfuns.c **** 	while(i<250)
 189              		.loc 1 58 2 view .LVU41
  57:Core/Src/exfuns.c **** 	u8 i=0,j;
 190              		.loc 1 57 5 is_stmt 0 view .LVU42
 191 0002 0023     		movs	r3, #0
 192              	.LVL9:
 193              	.L15:
 194              		.loc 1 58 7 is_stmt 1 view .LVU43
 195 0004 F92B     		cmp	r3, #249
 196 0006 05D8     		bhi	.L16
  59:Core/Src/exfuns.c **** 	{
  60:Core/Src/exfuns.c **** 		i++;
 197              		.loc 1 60 3 view .LVU44
 198              		.loc 1 60 4 is_stmt 0 view .LVU45
 199 0008 0133     		adds	r3, r3, #1
 200              	.LVL10:
 201              		.loc 1 60 4 view .LVU46
 202 000a DBB2     		uxtb	r3, r3
 203              	.LVL11:
  61:Core/Src/exfuns.c **** 		if(*fname=='\0')break;//偏移到了最后了.
 204              		.loc 1 61 3 is_stmt 1 view .LVU47
 205              		.loc 1 61 6 is_stmt 0 view .LVU48
 206 000c 0A78     		ldrb	r2, [r1]	@ zero_extendqisi2
 207              		.loc 1 61 5 view .LVU49
 208 000e 0AB1     		cbz	r2, .L16
  62:Core/Src/exfuns.c **** 		fname++;
 209              		.loc 1 62 3 is_stmt 1 view .LVU50
 210              		.loc 1 62 8 is_stmt 0 view .LVU51
 211 0010 0131     		adds	r1, r1, #1
 212              	.LVL12:
 213              		.loc 1 62 8 view .LVU52
 214 0012 F7E7     		b	.L15
 215              	.L16:
  63:Core/Src/exfuns.c **** 	}
  64:Core/Src/exfuns.c **** 	if(i==250)return 0XFF;//错误的字符串.
 216              		.loc 1 64 2 is_stmt 1 view .LVU53
 217              		.loc 1 64 4 is_stmt 0 view .LVU54
 218 0014 FA2B     		cmp	r3, #250
 219 0016 41D0     		beq	.L29
  54:Core/Src/exfuns.c **** 	u8 tbuf[5];
 220              		.loc 1 54 1 view .LVU55
 221 0018 70B5     		push	{r4, r5, r6, lr}
 222              	.LCFI1:
 223              		.cfi_def_cfa_offset 16
ARM GAS  C:\Users\ADMIN\AppData\Local\Temp\ccScV10L.s 			page 6


 224              		.cfi_offset 4, -16
 225              		.cfi_offset 5, -12
 226              		.cfi_offset 6, -8
 227              		.cfi_offset 14, -4
 228 001a 82B0     		sub	sp, sp, #8
 229              	.LCFI2:
 230              		.cfi_def_cfa_offset 24
  65:Core/Src/exfuns.c ****  	for(i=0;i<5;i++)//得到后缀名
 231              		.loc 1 65 8 view .LVU56
 232 001c 0023     		movs	r3, #0
 233              	.LVL13:
 234              	.L19:
 235              		.loc 1 65 11 is_stmt 1 discriminator 1 view .LVU57
 236              		.loc 1 65 3 is_stmt 0 discriminator 1 view .LVU58
 237 001e 042B     		cmp	r3, #4
 238 0020 08D8     		bhi	.L35
  66:Core/Src/exfuns.c **** 	{
  67:Core/Src/exfuns.c **** 		fname--;
 239              		.loc 1 67 3 is_stmt 1 view .LVU59
 240              		.loc 1 67 8 is_stmt 0 view .LVU60
 241 0022 481E     		subs	r0, r1, #1
 242              	.LVL14:
  68:Core/Src/exfuns.c **** 		if(*fname=='.')
 243              		.loc 1 68 3 is_stmt 1 view .LVU61
 244              		.loc 1 68 6 is_stmt 0 view .LVU62
 245 0024 11F8012C 		ldrb	r2, [r1, #-1]	@ zero_extendqisi2
 246              		.loc 1 68 5 view .LVU63
 247 0028 2E2A     		cmp	r2, #46
 248 002a 04D0     		beq	.L20
  65:Core/Src/exfuns.c ****  	for(i=0;i<5;i++)//得到后缀名
 249              		.loc 1 65 15 is_stmt 1 discriminator 2 view .LVU64
  65:Core/Src/exfuns.c ****  	for(i=0;i<5;i++)//得到后缀名
 250              		.loc 1 65 16 is_stmt 0 discriminator 2 view .LVU65
 251 002c 0133     		adds	r3, r3, #1
 252              	.LVL15:
  65:Core/Src/exfuns.c ****  	for(i=0;i<5;i++)//得到后缀名
 253              		.loc 1 65 16 discriminator 2 view .LVU66
 254 002e DBB2     		uxtb	r3, r3
 255              	.LVL16:
  67:Core/Src/exfuns.c **** 		if(*fname=='.')
 256              		.loc 1 67 8 discriminator 2 view .LVU67
 257 0030 0146     		mov	r1, r0
 258 0032 F4E7     		b	.L19
 259              	.LVL17:
 260              	.L35:
  56:Core/Src/exfuns.c **** 	u8 i=0,j;
 261              		.loc 1 56 6 view .LVU68
 262 0034 0021     		movs	r1, #0
 263              	.LVL18:
 264              	.L20:
  69:Core/Src/exfuns.c **** 		{
  70:Core/Src/exfuns.c **** 			fname++;
  71:Core/Src/exfuns.c **** 			attr=fname;
  72:Core/Src/exfuns.c **** 			break;
  73:Core/Src/exfuns.c **** 		}
  74:Core/Src/exfuns.c ****   	}
  75:Core/Src/exfuns.c **** 	strcpy((char *)tbuf,(const char*)attr);//copy
ARM GAS  C:\Users\ADMIN\AppData\Local\Temp\ccScV10L.s 			page 7


 265              		.loc 1 75 2 is_stmt 1 view .LVU69
 266 0036 6846     		mov	r0, sp
 267 0038 FFF7FEFF 		bl	strcpy
 268              	.LVL19:
  76:Core/Src/exfuns.c ****  	for(i=0;i<4;i++)tbuf[i]=char_upper(tbuf[i]);//全部变为大写 
 269              		.loc 1 76 3 view .LVU70
 270              		.loc 1 76 8 is_stmt 0 view .LVU71
 271 003c 0024     		movs	r4, #0
 272              	.LVL20:
 273              	.L22:
 274              		.loc 1 76 11 is_stmt 1 discriminator 1 view .LVU72
 275              		.loc 1 76 3 is_stmt 0 discriminator 1 view .LVU73
 276 003e 032C     		cmp	r4, #3
 277 0040 0AD8     		bhi	.L36
 278              		.loc 1 76 19 is_stmt 1 discriminator 3 view .LVU74
 279              		.loc 1 76 27 is_stmt 0 discriminator 3 view .LVU75
 280 0042 02AB     		add	r3, sp, #8
 281 0044 1D19     		adds	r5, r3, r4
 282 0046 15F8080C 		ldrb	r0, [r5, #-8]	@ zero_extendqisi2
 283 004a FFF7FEFF 		bl	char_upper
 284              	.LVL21:
 285              		.loc 1 76 26 discriminator 3 view .LVU76
 286 004e 05F8080C 		strb	r0, [r5, #-8]
 287              		.loc 1 76 15 is_stmt 1 discriminator 3 view .LVU77
 288              		.loc 1 76 16 is_stmt 0 discriminator 3 view .LVU78
 289 0052 0134     		adds	r4, r4, #1
 290              	.LVL22:
 291              		.loc 1 76 16 discriminator 3 view .LVU79
 292 0054 E4B2     		uxtb	r4, r4
 293              	.LVL23:
 294              		.loc 1 76 16 discriminator 3 view .LVU80
 295 0056 F2E7     		b	.L22
 296              	.L36:
  77:Core/Src/exfuns.c **** 	for(i=0;i<6;i++)
 297              		.loc 1 77 7 view .LVU81
 298 0058 0025     		movs	r5, #0
 299 005a 19E0     		b	.L24
 300              	.LVL24:
 301              	.L26:
  78:Core/Src/exfuns.c **** 	{
  79:Core/Src/exfuns.c **** 		for(j=0;j<13;j++)
 302              		.loc 1 79 16 is_stmt 1 discriminator 2 view .LVU82
 303              		.loc 1 79 17 is_stmt 0 discriminator 2 view .LVU83
 304 005c 0134     		adds	r4, r4, #1
 305              	.LVL25:
 306              		.loc 1 79 17 discriminator 2 view .LVU84
 307 005e E4B2     		uxtb	r4, r4
 308              	.LVL26:
 309              	.L28:
 310              		.loc 1 79 11 is_stmt 1 discriminator 1 view .LVU85
 311              		.loc 1 79 3 is_stmt 0 discriminator 1 view .LVU86
 312 0060 0C2C     		cmp	r4, #12
 313 0062 13D8     		bhi	.L25
  80:Core/Src/exfuns.c **** 		{
  81:Core/Src/exfuns.c **** 			if(*FILE_TYPE_TBL[i][j]==0)break;//此组已经没有可对比的成员了.
 314              		.loc 1 81 4 is_stmt 1 view .LVU87
 315              		.loc 1 81 24 is_stmt 0 view .LVU88
ARM GAS  C:\Users\ADMIN\AppData\Local\Temp\ccScV10L.s 			page 8


 316 0064 05EB4503 		add	r3, r5, r5, lsl #1
 317 0068 05EB8303 		add	r3, r5, r3, lsl #2
 318 006c 2344     		add	r3, r3, r4
 319 006e 0C4A     		ldr	r2, .L38
 320 0070 52F82300 		ldr	r0, [r2, r3, lsl #2]
 321              		.loc 1 81 7 view .LVU89
 322 0074 0378     		ldrb	r3, [r0]	@ zero_extendqisi2
 323              		.loc 1 81 6 view .LVU90
 324 0076 4BB1     		cbz	r3, .L25
  82:Core/Src/exfuns.c **** 			if(strcmp((const char *)FILE_TYPE_TBL[i][j],(const char *)tbuf)==0)//找到了
 325              		.loc 1 82 4 is_stmt 1 view .LVU91
 326              		.loc 1 82 7 is_stmt 0 view .LVU92
 327 0078 6946     		mov	r1, sp
 328 007a FFF7FEFF 		bl	strcmp
 329              	.LVL27:
 330              		.loc 1 82 6 view .LVU93
 331 007e 0028     		cmp	r0, #0
 332 0080 ECD1     		bne	.L26
  83:Core/Src/exfuns.c **** 			{
  84:Core/Src/exfuns.c **** 				return (i<<4)|j;
 333              		.loc 1 84 5 is_stmt 1 view .LVU94
 334              		.loc 1 84 18 is_stmt 0 view .LVU95
 335 0082 44EA0510 		orr	r0, r4, r5, lsl #4
 336 0086 C0B2     		uxtb	r0, r0
 337              	.LVL28:
 338              	.L18:
  85:Core/Src/exfuns.c **** 			}
  86:Core/Src/exfuns.c **** 		}
  87:Core/Src/exfuns.c **** 	}
  88:Core/Src/exfuns.c **** 	return 0XFF;//没找到		 			   
  89:Core/Src/exfuns.c **** }	 
 339              		.loc 1 89 1 view .LVU96
 340 0088 02B0     		add	sp, sp, #8
 341              	.LCFI3:
 342              		.cfi_remember_state
 343              		.cfi_def_cfa_offset 16
 344              		@ sp needed
 345 008a 70BD     		pop	{r4, r5, r6, pc}
 346              	.LVL29:
 347              	.L25:
 348              	.LCFI4:
 349              		.cfi_restore_state
  77:Core/Src/exfuns.c **** 	{
 350              		.loc 1 77 14 is_stmt 1 discriminator 2 view .LVU97
  77:Core/Src/exfuns.c **** 	{
 351              		.loc 1 77 15 is_stmt 0 discriminator 2 view .LVU98
 352 008c 0135     		adds	r5, r5, #1
 353              	.LVL30:
  77:Core/Src/exfuns.c **** 	{
 354              		.loc 1 77 15 discriminator 2 view .LVU99
 355 008e EDB2     		uxtb	r5, r5
 356              	.LVL31:
 357              	.L24:
  77:Core/Src/exfuns.c **** 	{
 358              		.loc 1 77 10 is_stmt 1 discriminator 1 view .LVU100
  77:Core/Src/exfuns.c **** 	{
 359              		.loc 1 77 2 is_stmt 0 discriminator 1 view .LVU101
ARM GAS  C:\Users\ADMIN\AppData\Local\Temp\ccScV10L.s 			page 9


 360 0090 052D     		cmp	r5, #5
 361 0092 01D8     		bhi	.L37
  79:Core/Src/exfuns.c **** 		{
 362              		.loc 1 79 8 view .LVU102
 363 0094 0024     		movs	r4, #0
 364 0096 E3E7     		b	.L28
 365              	.L37:
  88:Core/Src/exfuns.c **** }	 
 366              		.loc 1 88 9 view .LVU103
 367 0098 FF20     		movs	r0, #255
 368 009a F5E7     		b	.L18
 369              	.LVL32:
 370              	.L29:
 371              	.LCFI5:
 372              		.cfi_def_cfa_offset 0
 373              		.cfi_restore 4
 374              		.cfi_restore 5
 375              		.cfi_restore 6
 376              		.cfi_restore 14
  64:Core/Src/exfuns.c ****  	for(i=0;i<5;i++)//得到后缀名
 377              		.loc 1 64 19 view .LVU104
 378 009c FF20     		movs	r0, #255
 379              		.loc 1 89 1 view .LVU105
 380 009e 7047     		bx	lr
 381              	.L39:
 382              		.align	2
 383              	.L38:
 384 00a0 00000000 		.word	.LANCHOR4
 385              		.cfi_endproc
 386              	.LFE135:
 388              		.section	.text.exf_getfree,"ax",%progbits
 389              		.align	1
 390              		.global	exf_getfree
 391              		.syntax unified
 392              		.thumb
 393              		.thumb_func
 394              		.fpu fpv4-sp-d16
 396              	exf_getfree:
 397              	.LVL33:
 398              	.LFB136:
  90:Core/Src/exfuns.c **** 
  91:Core/Src/exfuns.c **** //得到磁盘剩余容量
  92:Core/Src/exfuns.c **** //drv:磁盘编号("0:"/"1:")
  93:Core/Src/exfuns.c **** //total:总容量	 （单位KB）
  94:Core/Src/exfuns.c **** //free:剩余容量	 （单位KB）
  95:Core/Src/exfuns.c **** //返回值:0,正常.其他,错误代码
  96:Core/Src/exfuns.c **** u8 exf_getfree(u8 *drv,u32 *total,u32 *free)
  97:Core/Src/exfuns.c **** {
 399              		.loc 1 97 1 is_stmt 1 view -0
 400              		.cfi_startproc
 401              		@ args = 0, pretend = 0, frame = 8
 402              		@ frame_needed = 0, uses_anonymous_args = 0
 403              		.loc 1 97 1 is_stmt 0 view .LVU107
 404 0000 30B5     		push	{r4, r5, lr}
 405              	.LCFI6:
 406              		.cfi_def_cfa_offset 12
 407              		.cfi_offset 4, -12
ARM GAS  C:\Users\ADMIN\AppData\Local\Temp\ccScV10L.s 			page 10


 408              		.cfi_offset 5, -8
 409              		.cfi_offset 14, -4
 410 0002 83B0     		sub	sp, sp, #12
 411              	.LCFI7:
 412              		.cfi_def_cfa_offset 24
 413 0004 0D46     		mov	r5, r1
 414 0006 1446     		mov	r4, r2
  98:Core/Src/exfuns.c **** 	FATFS *fs1;
 415              		.loc 1 98 2 is_stmt 1 view .LVU108
  99:Core/Src/exfuns.c **** 	u8 res;
 416              		.loc 1 99 2 view .LVU109
 100:Core/Src/exfuns.c ****     u32 fre_clust=0, fre_sect=0, tot_sect=0;
 417              		.loc 1 100 5 view .LVU110
 418              		.loc 1 100 9 is_stmt 0 view .LVU111
 419 0008 0023     		movs	r3, #0
 420 000a 0093     		str	r3, [sp]
 421              	.LVL34:
 101:Core/Src/exfuns.c ****     //得到磁盘信息及空闲簇数量
 102:Core/Src/exfuns.c ****     res =(u32)f_getfree((const TCHAR*)drv, (DWORD*)&fre_clust, &fs1);
 422              		.loc 1 102 5 is_stmt 1 view .LVU112
 423              		.loc 1 102 15 is_stmt 0 view .LVU113
 424 000c 01AA     		add	r2, sp, #4
 425              	.LVL35:
 426              		.loc 1 102 15 view .LVU114
 427 000e 6946     		mov	r1, sp
 428              	.LVL36:
 429              		.loc 1 102 15 view .LVU115
 430 0010 FFF7FEFF 		bl	f_getfree
 431              	.LVL37:
 103:Core/Src/exfuns.c ****     if(res==0)
 432              		.loc 1 103 5 is_stmt 1 view .LVU116
 433              		.loc 1 103 7 is_stmt 0 view .LVU117
 434 0014 60B9     		cbnz	r0, .L41
 104:Core/Src/exfuns.c **** 	{											   
 105:Core/Src/exfuns.c **** 	    tot_sect=(fs1->n_fatent-2)*fs1->csize;	//得到总扇区数
 435              		.loc 1 105 6 is_stmt 1 view .LVU118
 436              		.loc 1 105 19 is_stmt 0 view .LVU119
 437 0016 019A     		ldr	r2, [sp, #4]
 438 0018 5369     		ldr	r3, [r2, #20]
 439              		.loc 1 105 29 view .LVU120
 440 001a 023B     		subs	r3, r3, #2
 441              		.loc 1 105 36 view .LVU121
 442 001c 9278     		ldrb	r2, [r2, #2]	@ zero_extendqisi2
 443              		.loc 1 105 14 view .LVU122
 444 001e 02FB03F3 		mul	r3, r2, r3
 445              	.LVL38:
 106:Core/Src/exfuns.c **** 	    fre_sect=fre_clust*fs1->csize;			//得到空闲扇区数	   
 446              		.loc 1 106 6 is_stmt 1 view .LVU123
 447              		.loc 1 106 24 is_stmt 0 view .LVU124
 448 0022 0099     		ldr	r1, [sp]
 449              		.loc 1 106 14 view .LVU125
 450 0024 01FB02F2 		mul	r2, r1, r2
 451              	.LVL39:
 107:Core/Src/exfuns.c **** #if _MAX_SS!=512				  				//扇区大小不是512字节,则转换为512字节
 108:Core/Src/exfuns.c **** 		tot_sect*=fs1->ssize/512;
 109:Core/Src/exfuns.c **** 		fre_sect*=fs1->ssize/512;
 110:Core/Src/exfuns.c **** #endif	  
ARM GAS  C:\Users\ADMIN\AppData\Local\Temp\ccScV10L.s 			page 11


 111:Core/Src/exfuns.c **** 		*total=tot_sect>>1;	//单位为KB
 452              		.loc 1 111 3 is_stmt 1 view .LVU126
 453              		.loc 1 111 18 is_stmt 0 view .LVU127
 454 0028 5B08     		lsrs	r3, r3, #1
 455              	.LVL40:
 456              		.loc 1 111 9 view .LVU128
 457 002a 2B60     		str	r3, [r5]
 458              	.LVL41:
 112:Core/Src/exfuns.c **** 		*free=fre_sect>>1;	//单位为KB 
 459              		.loc 1 112 3 is_stmt 1 view .LVU129
 460              		.loc 1 112 17 is_stmt 0 view .LVU130
 461 002c 5208     		lsrs	r2, r2, #1
 462              	.LVL42:
 463              		.loc 1 112 8 view .LVU131
 464 002e 2260     		str	r2, [r4]
 465              	.L41:
 113:Core/Src/exfuns.c ****  	}
 114:Core/Src/exfuns.c **** 	return res;
 466              		.loc 1 114 2 is_stmt 1 view .LVU132
 115:Core/Src/exfuns.c **** }		   
 467              		.loc 1 115 1 is_stmt 0 view .LVU133
 468 0030 03B0     		add	sp, sp, #12
 469              	.LCFI8:
 470              		.cfi_def_cfa_offset 12
 471              		@ sp needed
 472 0032 30BD     		pop	{r4, r5, pc}
 473              		.loc 1 115 1 view .LVU134
 474              		.cfi_endproc
 475              	.LFE136:
 477              		.global	fatbuf
 478              		.global	dir
 479              		.global	fileinfo
 480              		.global	bw
 481              		.global	br
 482              		.global	ftemp
 483              		.global	file
 484              		.global	fs
 485              		.global	FILE_TYPE_TBL
 486              		.section	.rodata.str1.4,"aMS",%progbits,1
 487              		.align	2
 488              	.LC0:
 489 0000 42494E00 		.ascii	"BIN\000"
 490              		.align	2
 491              	.LC1:
 492 0004 4C524300 		.ascii	"LRC\000"
 493              		.align	2
 494              	.LC2:
 495 0008 4E455300 		.ascii	"NES\000"
 496              		.align	2
 497              	.LC3:
 498 000c 54585400 		.ascii	"TXT\000"
 499              		.align	2
 500              	.LC4:
 501 0010 4300     		.ascii	"C\000"
 502 0012 0000     		.align	2
 503              	.LC5:
 504 0014 4800     		.ascii	"H\000"
ARM GAS  C:\Users\ADMIN\AppData\Local\Temp\ccScV10L.s 			page 12


 505 0016 0000     		.align	2
 506              	.LC6:
 507 0018 4D503100 		.ascii	"MP1\000"
 508              		.align	2
 509              	.LC7:
 510 001c 4D503200 		.ascii	"MP2\000"
 511              		.align	2
 512              	.LC8:
 513 0020 4D503300 		.ascii	"MP3\000"
 514              		.align	2
 515              	.LC9:
 516 0024 4D503400 		.ascii	"MP4\000"
 517              		.align	2
 518              	.LC10:
 519 0028 4D344100 		.ascii	"M4A\000"
 520              		.align	2
 521              	.LC11:
 522 002c 33475000 		.ascii	"3GP\000"
 523              		.align	2
 524              	.LC12:
 525 0030 33473200 		.ascii	"3G2\000"
 526              		.align	2
 527              	.LC13:
 528 0034 4F474700 		.ascii	"OGG\000"
 529              		.align	2
 530              	.LC14:
 531 0038 41434300 		.ascii	"ACC\000"
 532              		.align	2
 533              	.LC15:
 534 003c 574D4100 		.ascii	"WMA\000"
 535              		.align	2
 536              	.LC16:
 537 0040 57415600 		.ascii	"WAV\000"
 538              		.align	2
 539              	.LC17:
 540 0044 4D494400 		.ascii	"MID\000"
 541              		.align	2
 542              	.LC18:
 543 0048 464C4143 		.ascii	"FLAC\000"
 543      00
 544 004d 000000   		.align	2
 545              	.LC19:
 546 0050 424D5000 		.ascii	"BMP\000"
 547              		.align	2
 548              	.LC20:
 549 0054 4A504700 		.ascii	"JPG\000"
 550              		.align	2
 551              	.LC21:
 552 0058 4A504547 		.ascii	"JPEG\000"
 552      00
 553 005d 000000   		.align	2
 554              	.LC22:
 555 0060 47494600 		.ascii	"GIF\000"
 556              		.section	.bss.br,"aw",%nobits
 557              		.align	2
 560              	br:
 561 0000 00000000 		.space	4
ARM GAS  C:\Users\ADMIN\AppData\Local\Temp\ccScV10L.s 			page 13


 562              		.section	.bss.bw,"aw",%nobits
 563              		.align	2
 566              	bw:
 567 0000 00000000 		.space	4
 568              		.section	.bss.dir,"aw",%nobits
 569              		.align	2
 572              	dir:
 573 0000 00000000 		.space	36
 573      00000000 
 573      00000000 
 573      00000000 
 573      00000000 
 574              		.section	.bss.fatbuf,"aw",%nobits
 575              		.align	2
 576              		.set	.LANCHOR3,. + 0
 579              	fatbuf:
 580 0000 00000000 		.space	4
 581              		.section	.bss.file,"aw",%nobits
 582              		.align	2
 583              		.set	.LANCHOR1,. + 0
 586              	file:
 587 0000 00000000 		.space	4
 588              		.section	.bss.fileinfo,"aw",%nobits
 589              		.align	2
 592              	fileinfo:
 593 0000 00000000 		.space	32
 593      00000000 
 593      00000000 
 593      00000000 
 593      00000000 
 594              		.section	.bss.fs,"aw",%nobits
 595              		.align	2
 596              		.set	.LANCHOR0,. + 0
 599              	fs:
 600 0000 00000000 		.space	8
 600      00000000 
 601              		.section	.bss.ftemp,"aw",%nobits
 602              		.align	2
 603              		.set	.LANCHOR2,. + 0
 606              	ftemp:
 607 0000 00000000 		.space	4
 608              		.section	.data.FILE_TYPE_TBL,"aw"
 609              		.align	2
 610              		.set	.LANCHOR4,. + 0
 613              	FILE_TYPE_TBL:
 614 0000 00000000 		.word	.LC0
 615 0004 00000000 		.space	48
 615      00000000 
 615      00000000 
 615      00000000 
 615      00000000 
 616 0034 04000000 		.word	.LC1
 617 0038 00000000 		.space	48
 617      00000000 
 617      00000000 
 617      00000000 
 617      00000000 
ARM GAS  C:\Users\ADMIN\AppData\Local\Temp\ccScV10L.s 			page 14


 618 0068 08000000 		.word	.LC2
 619 006c 00000000 		.space	48
 619      00000000 
 619      00000000 
 619      00000000 
 619      00000000 
 620 009c 0C000000 		.word	.LC3
 621 00a0 10000000 		.word	.LC4
 622 00a4 14000000 		.word	.LC5
 623 00a8 00000000 		.space	40
 623      00000000 
 623      00000000 
 623      00000000 
 623      00000000 
 624 00d0 18000000 		.word	.LC6
 625 00d4 1C000000 		.word	.LC7
 626 00d8 20000000 		.word	.LC8
 627 00dc 24000000 		.word	.LC9
 628 00e0 28000000 		.word	.LC10
 629 00e4 2C000000 		.word	.LC11
 630 00e8 30000000 		.word	.LC12
 631 00ec 34000000 		.word	.LC13
 632 00f0 38000000 		.word	.LC14
 633 00f4 3C000000 		.word	.LC15
 634 00f8 40000000 		.word	.LC16
 635 00fc 44000000 		.word	.LC17
 636 0100 48000000 		.word	.LC18
 637 0104 50000000 		.word	.LC19
 638 0108 54000000 		.word	.LC20
 639 010c 58000000 		.word	.LC21
 640 0110 60000000 		.word	.LC22
 641 0114 00000000 		.space	36
 641      00000000 
 641      00000000 
 641      00000000 
 641      00000000 
 642              		.text
 643              	.Letext0:
 644              		.file 2 "d:\\install\\gnu arm embedded toolchain\\10 2020-q4-major\\arm-none-eabi\\include\\machin
 645              		.file 3 "d:\\install\\gnu arm embedded toolchain\\10 2020-q4-major\\arm-none-eabi\\include\\sys\\_
 646              		.file 4 "Core/Inc/stm32f4xx.h"
 647              		.file 5 "Core/Inc/integer.h"
 648              		.file 6 "Core/Inc/ff.h"
 649              		.file 7 "Core/Inc/exfuns.h"
 650              		.file 8 "d:\\install\\gnu arm embedded toolchain\\10 2020-q4-major\\arm-none-eabi\\include\\string
 651              		.file 9 "Core/Inc/malloc.h"
ARM GAS  C:\Users\ADMIN\AppData\Local\Temp\ccScV10L.s 			page 15


DEFINED SYMBOLS
                            *ABS*:00000000 exfuns.c
C:\Users\ADMIN\AppData\Local\Temp\ccScV10L.s:18     .text.exfuns_init:00000000 $t
C:\Users\ADMIN\AppData\Local\Temp\ccScV10L.s:26     .text.exfuns_init:00000000 exfuns_init
C:\Users\ADMIN\AppData\Local\Temp\ccScV10L.s:125    .text.exfuns_init:00000074 $d
C:\Users\ADMIN\AppData\Local\Temp\ccScV10L.s:133    .text.char_upper:00000000 $t
C:\Users\ADMIN\AppData\Local\Temp\ccScV10L.s:140    .text.char_upper:00000000 char_upper
C:\Users\ADMIN\AppData\Local\Temp\ccScV10L.s:169    .text.f_typetell:00000000 $t
C:\Users\ADMIN\AppData\Local\Temp\ccScV10L.s:176    .text.f_typetell:00000000 f_typetell
C:\Users\ADMIN\AppData\Local\Temp\ccScV10L.s:384    .text.f_typetell:000000a0 $d
C:\Users\ADMIN\AppData\Local\Temp\ccScV10L.s:389    .text.exf_getfree:00000000 $t
C:\Users\ADMIN\AppData\Local\Temp\ccScV10L.s:396    .text.exf_getfree:00000000 exf_getfree
C:\Users\ADMIN\AppData\Local\Temp\ccScV10L.s:579    .bss.fatbuf:00000000 fatbuf
C:\Users\ADMIN\AppData\Local\Temp\ccScV10L.s:572    .bss.dir:00000000 dir
C:\Users\ADMIN\AppData\Local\Temp\ccScV10L.s:592    .bss.fileinfo:00000000 fileinfo
C:\Users\ADMIN\AppData\Local\Temp\ccScV10L.s:566    .bss.bw:00000000 bw
C:\Users\ADMIN\AppData\Local\Temp\ccScV10L.s:560    .bss.br:00000000 br
C:\Users\ADMIN\AppData\Local\Temp\ccScV10L.s:606    .bss.ftemp:00000000 ftemp
C:\Users\ADMIN\AppData\Local\Temp\ccScV10L.s:586    .bss.file:00000000 file
C:\Users\ADMIN\AppData\Local\Temp\ccScV10L.s:599    .bss.fs:00000000 fs
C:\Users\ADMIN\AppData\Local\Temp\ccScV10L.s:613    .data.FILE_TYPE_TBL:00000000 FILE_TYPE_TBL
C:\Users\ADMIN\AppData\Local\Temp\ccScV10L.s:487    .rodata.str1.4:00000000 $d
C:\Users\ADMIN\AppData\Local\Temp\ccScV10L.s:557    .bss.br:00000000 $d
C:\Users\ADMIN\AppData\Local\Temp\ccScV10L.s:563    .bss.bw:00000000 $d
C:\Users\ADMIN\AppData\Local\Temp\ccScV10L.s:569    .bss.dir:00000000 $d
C:\Users\ADMIN\AppData\Local\Temp\ccScV10L.s:575    .bss.fatbuf:00000000 $d
C:\Users\ADMIN\AppData\Local\Temp\ccScV10L.s:582    .bss.file:00000000 $d
C:\Users\ADMIN\AppData\Local\Temp\ccScV10L.s:589    .bss.fileinfo:00000000 $d
C:\Users\ADMIN\AppData\Local\Temp\ccScV10L.s:595    .bss.fs:00000000 $d
C:\Users\ADMIN\AppData\Local\Temp\ccScV10L.s:602    .bss.ftemp:00000000 $d
C:\Users\ADMIN\AppData\Local\Temp\ccScV10L.s:609    .data.FILE_TYPE_TBL:00000000 $d

UNDEFINED SYMBOLS
mymalloc
strcpy
strcmp
f_getfree
